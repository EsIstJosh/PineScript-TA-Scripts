//@version=1
study("ALMA-Weighted Momentum", overlay=false)
tf=input('1D',type=resolution )
length=input(32)
useCV=input(false, type=bool, title="Use Cumulative Volume")
renderBands=input(false, type=bool, title="Draw Envelope")
nbfs = useCV ? cum(volume) : sum(volume, length)
medianSrc= security(tickerid,tf,close)
calc_evwma(price, length, nb_floating_shares) =>
    data = (nz(data[1]) * (nb_floating_shares - volume)/nb_floating_shares) + (volume*price/nb_floating_shares)
    data

m=calc_evwma(medianSrc, length, nbfs)




A1Length  = input(16,  title="ALMA 1 Length")
A2Length  = input(32,  title="ALMA 2 Length")
A3Length  = input(64,  title="ALMA 3 Length")
A4Length  = input(80,  title="ALMA 4 Length")
A5Length  = input(128, title="ALMA 5 Length")
A6Length  = input(160, title="ALMA 11 Length")
A7Length  = input(200, title="ALMA 22 Length")
A8Length  = input(256, title="ALMA 33 Length")
A9Length  = input(300, title="ALMA 44 Length")
A10Length = input(360, title="ALMA 55 Length")
A11Length = input(420, title="ALMA 66 Length")


Offset = input(.66,          title="ALMA Offset")
Sigma  = input(6,            title="ALMA Sigma ")
src    = input(defval=close, title="Source1", type=source )


transplev =input(defval=30,title="Transparency 1", type=integer,  minval=0, maxval=100)
transplev2=input(defval=75,title="Transparency 2", type=integer,  minval=0, maxval=100)
transplev3=input(defval=10,title="Transparency 3", type=integer,  minval=0, maxval=100)

curve1   = alma(m,A1Length                                 ,Offset,Sigma)
curve1a  = alma(m,A1Length + (A2Length  - A1Length)   / 5  ,Offset,Sigma)   
curve1b  = alma(m,A1Length + (A2Length  - A1Length)   / 5*2,Offset,Sigma)
curve1c  = alma(m,A1Length + (A2Length  - A1Length)   / 5*3,Offset,Sigma)
curve1d  = alma(m,A1Length + (A2Length  - A1Length)   / 5*4,Offset,Sigma)
curve1e  = alma(m,A1Length + (A2Length  - A1Length)   / 5*5,Offset,Sigma)
curve1f  = alma(m,A1Length + (A2Length  - A1Length)   / 5*6,Offset,Sigma)
curve2   = alma(m,A2Length                                 ,Offset,Sigma)
curve2a  = alma(m,A2Length + (A3Length  - A2Length)   / 5  ,Offset,Sigma) 
curve2b  = alma(m,A2Length + (A3Length  - A2Length)   / 5*2,Offset,Sigma)
curve2c  = alma(m,A2Length + (A3Length  - A2Length)   / 5*3,Offset,Sigma)
curve2d  = alma(m,A2Length + (A3Length  - A2Length)   / 5*4,Offset,Sigma)
curve2e  = alma(m,A2Length + (A3Length  - A2Length)   / 5*5,Offset,Sigma)
curve2f  = alma(m,A2Length + (A3Length  - A2Length)   / 5*6,Offset,Sigma)
curve3   = alma(m,A3Length                                 ,Offset,Sigma)
curve3a  = alma(m,A3Length + (A4Length  - A3Length)   / 5  ,Offset,Sigma)
curve3b  = alma(m,A3Length + (A4Length  - A3Length)   / 5*2,Offset,Sigma)
curve3c  = alma(m,A3Length + (A4Length  - A3Length)   / 5*3,Offset,Sigma)
curve3d  = alma(m,A3Length + (A4Length  - A3Length)   / 5*4,Offset,Sigma)
curve3e  = alma(m,A3Length + (A4Length  - A3Length)   / 5*5,Offset,Sigma)
curve3f  = alma(m,A3Length + (A4Length  - A3Length)   / 5*6,Offset,Sigma)
curve4   = alma(m,A4Length                                 ,Offset,Sigma)
curve4a  = alma(m,A4Length + (A5Length  - A4Length)   / 5  ,Offset,Sigma)
curve4b  = alma(m,A4Length + (A5Length  - A4Length)   / 5*2,Offset,Sigma)
curve4c  = alma(m,A4Length + (A5Length  - A4Length)   / 5*3,Offset,Sigma)
curve4d  = alma(m,A4Length + (A5Length  - A4Length)   / 5*4,Offset,Sigma)
curve4e  = alma(m,A4Length + (A5Length  - A4Length)   / 5*5,Offset,Sigma)
curve4f  = alma(m,A4Length + (A5Length  - A4Length)   / 5*6,Offset,Sigma)
curve5   = alma(m,A5Length                                 ,Offset,Sigma)
curve5a  = alma(m,A5Length + (A6Length  - A5Length)   / 5  ,Offset,Sigma)  
curve5b  = alma(m,A5Length + (A6Length  - A5Length)   / 5*2,Offset,Sigma)
curve5c  = alma(m,A5Length + (A6Length  - A5Length)   / 5*3,Offset,Sigma)
curve5d  = alma(m,A5Length + (A6Length  - A5Length)   / 5*4,Offset,Sigma)
curve5e  = alma(m,A5Length + (A6Length  - A5Length)   / 5*5,Offset,Sigma)
curve5f  = alma(m,A5Length + (A6Length  - A5Length)   / 5*6,Offset,Sigma)
curve6   = alma(m,A6Length                                 ,Offset,Sigma)
curve6a  = alma(m,A6Length + (A7Length  - A6Length)   / 5  ,Offset,Sigma)
curve6b  = alma(m,A6Length + (A7Length  - A6Length)   / 5*2,Offset,Sigma)
curve6c  = alma(m,A6Length + (A7Length  - A6Length)   / 5*3,Offset,Sigma)
curve6d  = alma(m,A6Length + (A7Length  - A6Length)   / 5*4,Offset,Sigma)
curve6e  = alma(m,A6Length + (A7Length  - A6Length)   / 5*5,Offset,Sigma)
curve6f  = alma(m,A6Length + (A7Length  - A6Length)   / 5*6,Offset,Sigma)
curve7   = alma(m,A7Length                                 ,Offset,Sigma)
curve7a  = alma(m,A7Length + (A8Length  - A7Length)   / 5  ,Offset,Sigma)
curve7b  = alma(m,A7Length + (A8Length  - A7Length)   / 5*2,Offset,Sigma)
curve7c  = alma(m,A7Length + (A8Length  - A7Length)   / 5*3,Offset,Sigma)
curve7d  = alma(m,A7Length + (A8Length  - A7Length)   / 5*4,Offset,Sigma)
curve7e  = alma(m,A7Length + (A8Length  - A7Length)   / 5*5,Offset,Sigma)
curve7f  = alma(m,A7Length + (A8Length  - A7Length)   / 5*6,Offset,Sigma)
curve8   = alma(m,A8Length                                 ,Offset,Sigma)
curve8a  = alma(m,A8Length + (A9Length  - A8Length)   / 5  ,Offset,Sigma)
curve8b  = alma(m,A8Length + (A9Length  - A8Length)   / 5*2,Offset,Sigma)
curve8c  = alma(m,A8Length + (A9Length  - A8Length)   / 5*3,Offset,Sigma)
curve8d  = alma(m,A8Length + (A9Length  - A8Length)   / 5*4,Offset,Sigma)
curve8e  = alma(m,A8Length + (A9Length  - A8Length)   / 5*5,Offset,Sigma)
curve8f  = alma(m,A8Length + (A9Length  - A8Length)   / 5*6,Offset,Sigma)
curve9   = alma(m,A9Length                                 ,Offset,Sigma)
curve9a  = alma(m,A9Length + (A10Length - A9Length)   / 5  ,Offset,Sigma)
curve9b  = alma(m,A9Length + (A10Length - A9Length)   / 5*2,Offset,Sigma)
curve9c  = alma(m,A9Length + (A10Length - A9Length)   / 5*3,Offset,Sigma)
curve9d  = alma(m,A9Length + (A10Length - A9Length)   / 5*4,Offset,Sigma)
curve9e  = alma(m,A9Length + (A10Length - A9Length)   / 5*5,Offset,Sigma)
curve9f  = alma(m,A9Length + (A10Length - A9Length)   / 5*6,Offset,Sigma)
curve10  = alma(m,A10Length                                ,Offset,Sigma)
curve10a = alma(m,A10Length + (A11Length - A10Length) / 5  ,Offset,Sigma)   
curve10b = alma(m,A10Length + (A11Length - A10Length) / 5*2,Offset,Sigma)
curve10c = alma(m,A10Length + (A11Length - A10Length) / 5*3,Offset,Sigma)
curve10d = alma(m,A10Length + (A11Length - A10Length) / 5*4,Offset,Sigma)
curve10e = alma(m,A10Length + (A11Length - A10Length) / 5*5,Offset,Sigma)
curve10f = alma(m,A10Length + (A11Length - A10Length) / 5*6,Offset,Sigma)
av1      = rsi((curve1 + curve1a + curve1b + curve1c + curve1d + curve1e) /6 ,64 )
av2      = rsi((curve2 + curve2a + curve2b + curve2c + curve2d + curve2e) /6 ,64 )
av3      = rsi((curve3 + curve3a + curve3b + curve3c + curve3d + curve3e) /6 ,64 )
av4      = rsi((curve4 + curve4a + curve4b + curve4c + curve4d + curve4e) /6 ,64 )
av5      = rsi((curve5 + curve5a + curve5b + curve5c + curve5d + curve5e) /6 ,64 )
av6      = rsi((curve6 + curve6a + curve6b + curve6c + curve6d + curve6e) /6 ,64 )
av7      = rsi((curve7 + curve7a + curve7b + curve7c + curve7d + curve7e) /6 ,64 )
av8      = rsi((curve8 + curve8a + curve8b + curve8c + curve8d + curve8e) /6 ,64 )
av9      = rsi((curve9 + curve9a + curve9b + curve9c + curve9d + curve9e) /6 ,64 )
rsiclose = rsi(ema(close,32),64)
av       = (curve1 + curve2 + curve3 + curve4 + curve5 + curve6 + curve8 + curve7 + curve9 )/9
ava      = (curve1a + curve2a + curve3a + curve4a + curve5a + curve6a + curve7a + curve8a + curve9a)/9
avb      = (curve1b + curve2b + curve3b + curve4b + curve5b + curve6b + curve7b + curve8b + curve9b)/9
avc      = (curve1c + curve2c + curve3c + curve4c + curve5c + curve6c + curve7c + curve8c + curve9c)/9
avd      = (curve1d + curve2d + curve3d + curve4d + curve5d + curve6d + curve7d + curve8d + curve9d)/9
ave      = (curve1e + curve2e + curve3e + curve4e + curve5e + curve6e + curve7e + curve8e + curve9e)/9


mav1= mom(av1,24)
mav2= mom(av2,24)
mav3= mom(av3,24)
mav4= mom(av4,24)
mav5= mom(av5,24)
mav6= mom(av6,24)
mav7= mom(av7,24)
mav8= mom(av8,24)
mav9= mom(av9,24)
mavrsi=mom(wma(rsiclose,8),24)
mamom = mom(wma(m,32),24)
rsiplot = plot(mavrsi,color=fuchsia,linewidth=2,style=circles,transp=50)
plotav1 = plot(mav1,color=yellow,linewidth=2)
plotav2 = plot(mav2,color=orange,linewidth=1)
plotav3 = plot(mav3,color=red,linewidth=2)
plotav4 = plot(mav4,color=maroon,linewidth=1)
plotav5 = plot(mav5,color=purple,linewidth=2)
plotav6 = plot(mav6,color=#4106c2,linewidth=1)
plotav7 = plot(mav7,color=blue,linewidth=2)
plotav8 = plot(mav8,color=teal,linewidth=1)
plotav9 = plot(mav9,color=aqua,linewidth=2)
fill(plotav1,plotav2,color=yellow)
fill(plotav2,plotav3,color=orange)
fill(plotav3,plotav4,color=red)
fill(plotav4,plotav5,color=maroon)
fill(plotav5,plotav6,color=purple)
fill(plotav6,plotav7,color=#4106c2)
fill(plotav7,plotav8,color=blue)
fill(plotav8,plotav9,color=aqua)
h1 = hline(0  ,color=white,linewidth=2, linestyle=solid )
h2 = hline(40 ,color=lime,linewidth=1,  linestyle=dashed  )
h3 = hline(-40,color=maroon,linewidth=1,linestyle=dashed)
h4 = hline(25 ,color=green,linewidth=1, linestyle=dotted )
h5 = hline(-25,color=red,linewidth=1,   linestyle=dotted   )
//plot(mamom,color=#ffdee0,style=circles)

